---
// --- BLOQUE 1: FRONTMATTER (Servidor) ---

// 1. Importamos el componente "hijo" que vamos a mostrar.
import SshPanel from './ConsolaSSH.astro';
import SubirArchivos from './CarruselAdmin.astro';
import UserAdmin from './UserAdmin.astro';
---

<div 
  class="panel-container w-full h-[90vh] bg-dark-primary text-gray-200 rounded-lg overflow-hidden" 
  client:load
>
  
  <div id="view-menu" class="p-8 h-full" style="display: block;">
    <h2 class="text-3xl font-bold mb-8 text-light">
      Panel de Administración
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      
      <button 
        class="show-tool-btn p-8 bg-dark-secondary rounded-lg text-left transition-all duration-200 hover:bg-dark-highlight hover:border-light border border-dark-accent" 
        data-tool="tool-1"
      >
        <h3 class="text-xl font-semibold text-light mb-2">Conexión SSH</h3>
        <p class="text-gray-400">Accede a la terminal web de tus máquinas.</p>
      </button>

      <button 
        class="show-tool-btn p-8 bg-dark-secondary rounded-lg text-left transition-all duration-200 hover:bg-dark-highlight hover:border-light border border-dark-accent" 
        data-tool="tool-2"
      >
        <h3 class="text-xl font-semibold text-light mb-2">Modificar Carrusel</h3>
        <p class="text-gray-400">Accede a la pagina para modificar el carrusel principal.</p>
      </button>

      <button 
        class="show-tool-btn p-8 bg-dark-secondary rounded-lg text-left transition-all duration-200 hover:bg-dark-highlight hover:border-light border border-dark-accent" 
        data-tool="tool-3"
      >
        <h3 class="text-xl font-semibold text-light mb-2">Administración de Usuarios</h3>
        <p class="text-gray-400">Página de administración y modificación de roles de usuarios.</p>
      </button>

      <button 
        class="show-tool-btn p-8 bg-dark-secondary rounded-lg text-left transition-all duration-200 hover:bg-dark-highlight hover:border-light border border-dark-accent" 
        data-tool="tool-4"
      >
        <h3 class="text-xl font-semibold text-light mb-2">Foro</h3>
        <p class="text-gray-400">Próxima herramienta para la administración del foro.</p>
      </button>

    </div>
  </div>
  
  <div id="view-tool" class="h-full flex flex-col" style="display: none;">
    
    <header class="flex-shrink-0 w-full bg-dark-secondary p-4 border-b border-dark">
      <button 
        id="back-to-menu-btn" 
        class="flex items-center gap-2 px-4 py-2 rounded-md bg-dark-accent text-light font-medium transition-all hover:bg-dark-highlight"
      >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
        </svg>
        Volver al Menú
      </button>
    </header>
    
    <main class="flex-1 overflow-y-auto">
      
      <div id="tool-1" class="tool-wrapper h-full" style="display: none;">
        <SshPanel client:visible />
      </div>

      <div id="tool-2" class="tool-wrapper h-full" style="display: none;">
        <SubirArchivos client:visible />
      </div>

      <div id="tool-3" class="tool-wrapper h-full" style="display: none;">
        <UserAdmin client:visible />
      </div>

      <div id="tool-4" class="tool-wrapper h-full" style="display: none;">
        <SshPanel client:visible />
      </div>
      
    </main>
  </div>
</div>

<script>
  // Seleccionamos los elementos principales
  const menuView = document.getElementById('view-menu');
  const toolView = document.getElementById('view-tool');
  const backButton = document.getElementById('back-to-menu-btn');
  
  // Seleccionamos TODOS los botones que abren herramientas
  const toolButtons = document.querySelectorAll('.show-tool-btn');
  
  // Seleccionamos TODOS los contenedores de herramientas
  const toolWrappers = document.querySelectorAll('.tool-wrapper');

  /** Muestra el menú principal y oculta la vista de herramienta */
  function showMenu() {
    menuView.style.display = 'block';
    toolView.style.display = 'none';
  }

  /** Muestra la herramienta (dado su ID) y oculta el menú */
  function showTool(toolId) {
    // 1. Ocultar el menú, mostrar el contenedor de la herramienta
    menuView.style.display = 'none';
    toolView.style.display = 'block';
    
    // 2. Ocultar TODOS los wrappers de herramientas
    toolWrappers.forEach(wrapper => {
      (wrapper as HTMLElement).style.display = 'none';
    });
    
    // 3. Mostrar SÓLO el wrapper de la herramienta seleccionada
    const targetWrapper = document.getElementById(toolId);
    if (targetWrapper) {
      targetWrapper.style.display = 'block';
    }
  }

  // --- ASIGNACIÓN DE EVENTOS ---

  // 1. Asignar evento al botón "Volver"
  backButton.addEventListener('click', showMenu);
  
  // 2. Asignar evento a CADA botón del menú
  toolButtons.forEach(button => {
    button.addEventListener('click', (event) => {
      // Obtenemos el ID de la herramienta desde 'data-tool'
      const toolId = (event.currentTarget as HTMLElement).dataset.tool;
      if (toolId) {
        showTool(toolId);
      }
    });
  });
</script>